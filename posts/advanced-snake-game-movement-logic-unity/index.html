<!doctype html>
<html>
  <head>

    
    <meta property="og:image" content="/static/"/>
    <meta name="twitter:image" content="/static/" />
    



    <meta name="description" content="Programming a segmented snake-like &#39;tail&#39; which works in any direction at variable speeds. - Jack Brookes">

    <link rel="shortcut icon" href="/static/me_circ.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:300,400,700,300i,400i,700i|Open+Sans:400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/pygments.css">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jackbrookes" />
    <meta name="twitter:title" content="Advanced Snake Game Movement Logic (Unity C#)" />
    <meta name="twitter:description" content="Programming a segmented snake-like &#39;tail&#39; which works in any direction at variable speeds. - Jack Brookes" />



    <title>Advanced Snake Game Movement Logic (Unity C#) - Jack Brookes</title>

    
  
  </head>
  <body>
    <div id="centred-container">
      <ul id="navbar">
        <li class="navbutton"><a href="/" >Home</a></li>
        <li class="navbutton"><a href="/posts/" class="current">Posts</a></li>
        <li class="navbutton"><a href="/publications/" >Publications</a></li>
        <li class="navbutton"><a href="/about/" >About</a></li>
        <li class="navbutton"><a href="/contact/" >Contact</a></li>
        <li id="spacer">&nbsp;</li>
      </ul>
      <div id="content">
        
<h1 class="title">
  Advanced Snake Game Movement Logic (Unity C#)
</h1>

<p class="summary">
  Programming a segmented snake-like &#39;tail&#39; which works in any direction at variable speeds.
  
</p>

<p><a href="https://en.wikipedia.org/wiki/Snake_(video_game)">Snake</a> has been a
popular video game for decades, initially becoming popular in 1998,
where a version of it came pre-loaded on Nokia mobile phones.</p>
<p><img alt="Snake" src="/static/blog-images/snake.png" /></p>
<p>In these games the player controls a snake, with the snake's body
trailing behind it. The programming of these original games is quite
simple, and can be recreated with fairly simple logic:</p>
<ul>
<li>Render a square at the player's current position. Snake moves at a
   constant speed, moving to the next tile after a set time step.</li>
<li>Direction is changed when user presses a direction key.</li>
<li>The snake's body is represented with a list or array of positions, a
   position being the the x,y coordinate of the tile on the screen.</li>
<li>Every time the snake's head moves, we cascade down the list of
   positions such that the 1st element of the body is now where the head
   was last time step, and the 2nd element where the 1st was, and so on.</li>
<li>If the player collects food, its tail grows 1 tile longer. On the
   next time step a new element appears where the last part of the body
   was last step.</li>
</ul>
<p>A more efficient way could be to swap the position of the last block of
the tail with the new head position - which may be okay for a very
simple tile based movement implementation, but may cause later
headaches.</p>
<p>The above system is fine for these types of simple games, but what is we
want to use this type of logic with more flexibility? For example, in a
game where the 'head' doesn't move at a constant speed? If we were to
use the above logic, the snake's body would pile up on the head of the
snake when stopping, and there may be gaps in the snake when moving too
fast.</p>
<p>By the way - this isn't just a problem for Snake-like games, you can
imagine a myriad of game mechanics which require this type of movement.
It could be a trail of eggs that <a href="https://youtu.be/KfZsbBJ7AGc?t=85">follow Yoshi as he
moves</a> in <em>Yoshi Touch and Go</em>.</p>
<p>Below is a video of a game I made in Unity which showcases the more
advanced logic I have developed.</p>
<div class="intrinsic-container intrinsic-container-16x9">
    <iframe src="https://player.vimeo.com/video/176048481?autoplay=1&amp;loop=1"
    width="640"
    height="321"
    webkitallowfullscreen mozallowfullscreen allowfullscreen>
    </iframe>
  </div>

<h2>The code</h2>
<p>The logic behind this code is to shuffle the body elements forward when
the head of the snake moves outside a certain radius. This is different
from the classic system where the 'shuffling' happens at set time
intervals.</p>
<p>First, lets program (Unity C#) our 'circle' logic. First make a simple
GameObject (the Snake's head) and create a new script attached to it
called 'snakeController'. Note: this code won't work if copied exactly,
it is just a guide</p>
<div class="codehilite"><pre><span></span><span class="n">Vector3</span> <span class="n">circleCentre</span><span class="p">;</span>
<span class="n">Transform</span> <span class="n">headTransform</span><span class="p">;</span>


<span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// get transform component of snake head</span>
    <span class="n">headTransform</span> <span class="p">=</span> <span class="n">GetComponent</span> <span class="p">&lt;</span><span class="n">Transform</span><span class="p">&gt;();</span>

    <span class="c1">// start with circle centred at current position</span>
    <span class="n">circleCentre</span> <span class="p">=</span> <span class="n">currentHeadPostition</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>    
    <span class="c1">// get difference between current position and centre of circle</span>
    <span class="n">Vector3</span> <span class="n">diffVector</span><span class="p">;</span>
    <span class="n">diffVector</span> <span class="p">=</span> <span class="n">currentHeadPosition</span> <span class="p">-</span> <span class="n">circleCentre</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">freeMoveRadius</span> <span class="p">=</span> <span class="m">1f</span><span class="p">;</span>

    <span class="c1">// if the head leaves the circle, we run some shuffling code</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">diffVector</span><span class="p">.</span><span class="n">magnitude</span> <span class="p">&gt;</span> <span class="n">freeMoveRadius</span><span class="p">){</span>              
        <span class="cm">/*</span>
<span class="cm">        We should always be storing the position of all of the snake&#39;s body elements.</span>
<span class="cm">        When this part is triggered, we want to shuffle the elements up the list.</span>

<span class="cm">        e.g.</span>

<span class="cm">        if (listOfTailObjects.Count != 1) {</span>
<span class="cm">                for (int i = tail.Count-1; i &gt; 0; i--) {</span>
<span class="cm">                    listOfTailObjects [i].transform.position = listOfTailObjects [i - 1].transform.position;</span>
<span class="cm">                }</span>
<span class="cm">            }</span>
<span class="cm">        first part replaces head position</span>
<span class="cm">        listOfTailObjects [0].transform.position = circleCentre;</span>

<span class="cm">        */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This code is fine under a scenario where the player speed is limited
such that the head of the snake cannot move significantly outside the
circle in a single frame. If this is not the case, we need the
possibility of 'shuffling' our body elements multiple times per frame.
This can be done in a while loop - every iteration of the loop we move
the player to the edge of the circle in the direction they were moving,
redefine the centre of our new circle, then we shuffle, and repeat this
until the new position is not outside the circle any more. For this, our
update function should look like this:</p>
<div class="codehilite"><pre><span></span><span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>   
    <span class="c1">// get difference between current position and centre of circle</span>
    <span class="n">Vector3</span> <span class="n">diffVector</span><span class="p">;</span>
    <span class="n">diffVector</span> <span class="p">=</span> <span class="n">currentHeadPosition</span> <span class="p">-</span> <span class="n">circleCentre</span><span class="p">;</span>

    <span class="c1">// if the head leaves the circle, we start a while loop</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">diffVector</span><span class="p">.</span><span class="n">magnitude</span> <span class="p">&gt;</span> <span class="n">freeMoveRadius</span><span class="p">){</span>              
        <span class="k">while</span> <span class="p">(</span><span class="n">diffVector</span><span class="p">.</span><span class="n">magnitude</span> <span class="p">&gt;</span> <span class="n">freeMoveRadius</span><span class="p">){</span>
            <span class="c1">// define new circle, always inside or on the edge of current circle             </span>
            <span class="n">circleCentre</span> <span class="p">=</span> <span class="n">circleCentre</span> <span class="p">+</span> <span class="n">diffVector</span><span class="p">.</span><span class="n">normalized</span><span class="p">*</span><span class="n">Mathf</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">freeMoveRadius</span><span class="p">,</span><span class="n">diffVector</span><span class="p">.</span><span class="n">magnitude</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tail</span><span class="p">.</span><span class="n">Count</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//shuffling code</span>
            <span class="p">}</span>
            <span class="c1">// new difference           </span>
            <span class="n">diffVector</span> <span class="p">=</span> <span class="n">tr</span><span class="p">.</span><span class="n">position</span><span class="p">-</span><span class="n">circleCentre</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<div class="techbox cf">
  <h2 class="techused">Post tags:</h3>
  <ul class="tags">
    
      
        <li>
    <span class="tag">
      <i class="fa fa-gamepad fa-fw"
      style="color:#00cccc"
      aria-hidden="true"></i>
      Unity
    </span>
</li>
      
    
      
        <li>
    <span class="tag">
      <i class="fa fa-code fa-fw"
      style="color:#178600"
      aria-hidden="true"></i>
      C#
    </span>
</li>
      
    
      
        <li>
    <span class="tag">
      <i class="fa fa-superscript fa-fw"
      style="color:#f65a5b"
      aria-hidden="true"></i>
      Mathematics
    </span>
</li>
      
    
  </ul>
</div>


      </div>

    </div>
    <div id="footer-container">
      <div id="footer">
        
        <ul class="footer-ul">
          <li style="color: #8AB3CF; margin-bottom: 5px;">© Jack Brookes 2017</li>
          <li><a href="/">Home</a></li>
          <li><a href="/posts/">Posts</a></li>
          <li><a href="/publications/">Publications</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="/contact/">Contact</a></li>
          <li><a onclick="topFunction()" style="cursor:pointer">Back to top <i class="fa fa-fw fa-chevron-up" aria-hidden="true"></i></a></li>
        </ul>
        
      </div>
    </div>

    <script>
    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
    </script>


  </body>
</html>